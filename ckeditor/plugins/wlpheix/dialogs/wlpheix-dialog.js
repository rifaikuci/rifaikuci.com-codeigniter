CKEDITOR.dialog.add("wlpheixDialog",function(d){return{title:"Вставить изображение из системной галереи Pheix",minWidth:700,minHeight:300,contents:[{id:"tab-basic",label:"Выбор системной галереи",elements:[{type:"select",id:"sysgalleryselect",label:"Галерея-хранилище изображений:",items:"","default":"",style:"width:700px !important;",onChange:function(){var a=CKEDITOR.currentInstance,b=a.config.pheixGalDivId,c=parseInt(this.getValue());console.log("CKEditor: selected gallery: "+c);if(0<c){var e=a.config.pheixScript,
a=a.config.pheixSessionId;"undefined"===typeof e||null===e||"undefined"===typeof a||null===a?("undefined"!==typeof a&&null!==a||console.log("CKEditor: session id is undefined"),"undefined"!==typeof e&&null!==e||console.log("CKEditor: script is undefined")):(c=e+"?id\x3d"+a+"\x26amp;action\x3dadmgalgetpool\x26amp;galid\x3d"+c,console.log("CKEditor: request: "+c),jQuery.get(c).fail(function(a){console.log("CKEditor: get data from "+e+" failed: "+a)}).done(function(a){var c=CKEDITOR.dialog.getCurrent().getElement().getDocument().getById(b);
c?c.setHtml('\x3cdiv id\x3d"galCarousel" style\x3d"padding:0; margin:0 0 0 5px; background:#F1F1F1; width:690px"\x3e'+a+"\x3c/div\x3e"):console.log("CKEditor: element '"+b+"' is undefined")}))}else(c=CKEDITOR.dialog.getCurrent().getElement().getDocument().getById(b))&&c.setHtml("")},onLoad:function(){var a=this,b=CKEDITOR.currentInstance,c=b.config.pheixScript,b=b.config.pheixSessionId;"undefined"===typeof c||null===c||"undefined"===typeof b||null===b?("undefined"!==typeof b&&null!==b||console.log("CKEditor: session id is undefined"),
"undefined"!==typeof c&&null!==c||console.log("CKEditor: script is undefined")):(b=c+"?id\x3d"+b+"\x26amp;action\x3dadmgalgetall\x26amp;term\x3d*",console.log("CKEditor: request: "+b),jQuery.get(b).fail(function(a){console.log("CKEditor: get data from "+c+" failed: "+a)}).done(function(b){var f;try{f=$.parseJSON(b)}catch(d){f=[{label:"Module Gallery::System is inactive!",value:"-1",id:"0"}],console.log("CKEditor: JSON response parse error: "+d.name+" {"+d.message+"}")}$.each(f,function(b,c){a.add(c.label,
c.id)});console.log("CKEditor: get data from "+c+" done")}))}},{type:"text",id:"imgpath",label:"Путь к изображению:",validate:CKEDITOR.dialog.validate.notEmpty("Путь к изображению не может быть пустым")},{type:"html",id:"sgslider",html:'\x3cdiv id\x3d"'+d.config.pheixGalDivId+'"\x3e\x3c/div\x3e'}]}],onOk:function(){var a=d.document.createElement("imgpath"),b=this.getValueOf("tab-basic","imgpath");a.setHtml('\x3cimg src\x3d"'+b+'" border\x3d"0" alt\x3d""\x3e');d.insertElement(a)},onShow:function(){var a=
d.config.pheixScript,b=d.config.pheixSessionId;"undefined"===typeof a||null===a||"undefined"===typeof b||null===b?(console.log("CKEditor: found undefined settings while checking session id"),top.location.href="/"):jQuery.get(a+"?id\x3d"+b+"\x26action\x3dchecksession",function(b,d,f){"error"==d?(console.log("CKEditor: ajax request from "+a+" failed "+f.status+": "+f.statusText),top.location.href=a):0!=b.localeCompare("1")&&(console.log("CKEditor: session id is expired - redirecting to "+a),top.location.href=
a)},"text")},onCancel:function(){console.log("CKEditor: dialog cancel done")}}});